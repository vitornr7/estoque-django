{% extends 'estoque/base.html' %}

{% block corpo %}

<h1>Pedidos</h1>

<hr>

<form class="form-group" method="GET" action="{% url 'estoque:listar_pedidos' %}">
    {% include 'estoque/pesquisa/precos.html' %}
    {% include 'estoque/pesquisa/datas.html' %}

    <div class="form-row align-items-center">
        <div class="form-group col-auto">
            <div class="form-check form-check-inline">
                <input class="form-check-input " type="radio" name="status_pedido" id="radiostatus1" value="aberto"
                    checked>
                <label class="form-check-label" for="radiostatus1">Abertos</label>
            </div>

            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="status_pedido" id="radiostatus2" value="aprovado">
                <label class="form-check-label" for="radiostatus2">Aprovados</label>
            </div>

            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="status_pedido" id="radiostatus3" value="reprovado">
                <label class="form-check-label" for="radiostatus3">Reprovados</label>
            </div>
        </div>
        {% include 'estoque/pesquisa/produto.html' %}
        {% if request.user.is_superuser %}
        {% include 'estoque/pesquisa/empresa.html' %}
        {% endif %}
        <div class="form-group col">
            <button class="btn btn-outline-primary btn-sm" type="submit">Pesquisar</button>
        </div>
    </div>
</form>

<hr>

{% if request.GET.status_pedido == 'aprovado' %}
<strong>
    <div class="row">
        <div class="col-4">Total</div>
        <div class="col-8">{{ info.valor }}</div>
    </div>
    <div class="row">
        <div class="col-4">Quantidade</div>
        <div class="col-8">{{ info.qtd }}</div>
    </div>
</strong>
{% endif %}

<div class="row align-items-center">
    <div class="col-auto">
        <strong>
            Resultado da busca
            {% include 'estoque/pesquisa/pesq_status_pedido.html' %}
            {% if request.user.is_superuser %}{% include 'estoque/pesquisa/pesq_empresa.html' %}{% endif %}
            {% include 'estoque/pesquisa/pesq_produto.html' %}
            {% include 'estoque/pesquisa/pesq_preco.html' %}
            {% include 'estoque/pesquisa/pesq_data.html' %}
        </strong>
    </div>
    <div class="col">
        {% include 'estoque/relatorio/rel_venda.html' %}
        </form>
    </div>
</div>

<table class="table table-striped table-bordered table-sm">
    <thead class="thead-dark">
        <tr>
            <th scope="col">Status</th>
            {% if request.user.is_superuser %}<th scope="col">Empresa</th>{% endif %}
            <th scope="col">Produto</th>
            <th scope="col">Data</th>
            <th scope="col">Quantidade</th>
            <th scope="col">Valor</th>
            {% if request.user.is_superuser and status_pedido == 0 %}<th scope="col">Opções</th>{% endif %}
        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}

        <tr>
            <td>
                {{ pedido.get_status_display }}
            </td>
            {% if request.user.is_superuser %}
            <td>
                {{ pedido.empresa }}
            </td>
            {% endif %}
            <td>
                <a href="{% url 'estoque:detalhes_produto' pedido.produto.id %}">{{ pedido.produto }}</a>
            </td>
            <td>
                {{ pedido.data }}
            </td>
            <td>
                {{ pedido.quantidade }}
            </td>
            <td>
                {{ pedido.valor }}
            </td>
            {% if request.user.is_superuser and status_pedido == 0 %}
            <td>
                <a href="{% url 'estoque:aprovar_pedido' pedido.id %}"
                    class="badge badge-pill badge-success">Aprovar</a>
                <a href="{% url 'estoque:reprovar_pedido' pedido.id %}"
                    class="badge badge-pill badge-danger">Reprovar</a>
            </td>
            {% endif %}
        </tr>

        {% empty %}
        <tr>
            <td colspan=7>
                <h4>Nenhum resultado encontrado.</h4>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if pedidos.has_other_pages %}

<ul class="pagination float-right">
    <li class="page-item">
        <span class="page-link">{{ pedidos.number }}/{{ pedidos.paginator.num_pages }}</span>
    </li>

    {% if pedidos.has_previous %}
    <li class="page-item"><a class="page-link"
            href="?opcao_valor={{ request.GET.opcao_valor }}&valor1={{ request.GET.valor1 }}&valor2={{ request.GET.valor2 }}&opcao_data={{ request.GET.opcao_data }}&d1={{ request.GET.d1 }}&d2={{ request.GET.d2 }}&status_pedido={{ request.GET.status_pedido }}&nome_produto={{ request.GET.nome_produto }}&nome_empresa={{ request.GET.nome_empresa }}&page={{ pedidos.previous_page_number }}">Anterior</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Anterior</span></li>
    {% endif %}

    {% if pedidos.has_next %}
    <li class="page-item"><a class="page-link"
            href="?opcao_valor={{ request.GET.opcao_valor }}&valor1={{ request.GET.valor1 }}&valor2={{ request.GET.valor2 }}&opcao_data={{ request.GET.opcao_data }}&d1={{ request.GET.d1 }}&d2={{ request.GET.d2 }}&status_pedido={{ request.GET.status_pedido }}&nome_produto={{ request.GET.nome_produto }}&nome_empresa={{ request.GET.nome_empresa }}&page={{ pedidos.next_page_number }}">Proxima</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Proxima</span></li>
    {% endif %}

</ul>
{% endif %}

{% endblock %}
